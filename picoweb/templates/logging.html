{% args log_ts, log_aws, active_logger %}

<!DOCTYPE html>
<html lang="en">
    {% include 'head.tpl' %}
	<body>
       {% include 'masthead.tpl' %}
        <div id="vue_app" class="pagesection">
            <div  class="component">
                {% include 'component_header.tpl' 'Logging service' %}
                <div 
                    class="ui__body ani_height" 
                    :style="{ height: formheight }"
                    v-on:transitionend="ani_end"
                    
                >
                    <form ref="form" class="form form__logging">
                        <fieldset>
                            <p>
                                <label>
                                    Logging service
                                    <select 
                                        v-model="service"
                                        v-on:change="ani_start"
                                    >
                                        <option>-- No service selected --</option>
                                        <option{% if log_ts.name == active_logger %} selected{% endif %}>{{ log_ts.name }}</option>
                                        <option{% if log_aws.name == active_logger %} selected{% endif %}>{{ log_aws.name }}</option>
                                    </select>
                                </label>
                            </p>
                        </fieldset>
                        <fieldset v-cloak v-if="service=='ThingSpeak'">
                        <h3>ThingSpeak</h3>
                            <p>
                                <label>
                                    API Key <input type="text" v-model="ts.key">
                                </label>
                            </p>
                        </fieldset>
                        <fieldset v-cloak v-if="service=='AWS IoT'">
                            <h3>Amazon web service, IoT</h3>
                            <p>
                                <label>
                                    Certificate <input type="file">
                                </label>
                            </p>
                            <p>
                                <label>
                                    Private key <input type="file">
                                </label>
                            </p>
                            <p>
                                <label>
                                    Endpoint subdomain <input type="text" v-model="awsiot.subdomain">
                                </label>
                            </p>
                            <p>
                                <label>
                                    Endpoint region <input type="text" v-model="awsiot.region">
                                </label>
                            </p>
                        </fieldset>
                        <p>
                            <a class="button" href="/">Cancel</a> 
                            <button>Save</button>
                        </p>
                    </form>
                </div>
            </div>
        </div>
        {% include 'footer.tpl' %}
        <script>
            var app = new Vue({
                el: '#vue_app',
                data: {
                    formheight: "auto",
                    service :"{{ active_logger }}",
                    ts:{
                        key  : "{{ log_ts.key }}"              
                    },
                    awsiot:{
                        cert  : "{{ log_aws.cert }}",
                        key  : "{{ log_aws.key }}",
                        subdomain: "{{ log_aws.subdomain }}",
                        region: "{{ log_aws.region }}"   
                    }
                },
                methods:{
                    ani_start: function(){
                        var style = this.$refs.form.currentStyle || window.getComputedStyle(this.$refs.form);
                        var margintop = parseInt(style.marginTop.slice(0,-2));
                        var marginbottom = parseInt(style.marginBottom.slice(0,-2));
                        this.formheight = this.$refs.form.offsetHeight + margintop + marginbottom + "px";
                    },
                    ani_end: function(){
                        this.formheight = "auto";
                    }
                },
                updated:function(){
                    if(this.formheight != 'auto'){
                        this.ani_start();
                    }
                }
                
            })
        </script>
	</body>
</html>