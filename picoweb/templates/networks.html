{% args networks %}

<!DOCTYPE html>
<html lang="en">
    {% include 'head.tpl' %}
	<body>
       {% include 'masthead.tpl' %}
        <div id="vue_app" class="pagesection">
            <div class="component">
               {% include 'component_header.tpl' 'Networks' %}
                <div class="ui__body">
                    <ul class="navlist">
                        {% for network in networks %}
                        <li>
                            <a 
                                v-on:click.prevent="accordion($event, {{ network.id }})"
                                :class="linkClasses({{ network.id }})"
                                href="#"
                            >
                                {{ network.ssid }}
                                {% if network.connected %}<span class="details"> Connected</span>
                                {% elif network.pwd %}<span class="details"> Remembered</span>{% endif %}
                            </a>
                            {% include 'network_details.tpl' %}
                        </li>
                        {% endfor %}
                    </ul>
                    
                    <ul class="navlist">
                        <li>
                            <a
                                v-on:click.prevent="accordion($event, 'new')"
                                :class="linkClasses('new')"
                                href="#"
                            >
                                [+] Add network
                            </a>
                            {% include 'network_new.tpl' %}
                        </li>
                    </ul>
                </div>
            </div>
        </div>
       {% include 'footer.tpl' %}
       <script>
            var app = new Vue({
                el: '#vue_app',
                delimiters: ["[[","]]"],
                data:{
                    networks: [],
                    activeId: '-1'
                },
                methods:{
                    accordion: function(event, id){
                        if(this.activeId === id){
                            this.activeId = undefined;
                        }else{
                            this.activeId = id;
                        }
                    },
                    linkClasses(id){
                        if(this.activeId == id){
                            return 'active';
                        }
                        return '';
                    },
                    accStyles:function(id){
                        // Note: need to ensure accordion is not 'undefined'
                        var accordion = this.$refs['acc_'+id];
                        if(this.activeId != id){
                            return {height:'0px'}
                        }else if(accordion && accordion.offsetHeight == 0){
                        
                            var style = accordion.firstChild.currentStyle || window.getComputedStyle(accordion.firstChild);
                            var margintop = parseInt(style.marginTop.slice(0,-2));
                            var marginbottom = parseInt(style.marginBottom.slice(0,-2));
                        
                            return {height: accordion.firstChild.offsetHeight+ margintop + marginbottom + 'px'}
                        }else{
                            return {height:'0px'}
                        }
                    },
                    accClasses:function(id){
                        var classes = ['accordion','ani_height'];
                        if(this.activeId == id){
                            classes.push('active');
                        }
                        return classes.join(' ');
                    },
                    sortNetworks:function(){
                        this.networks.sort(function(a,b){
                            // Connected
                            if(a.connected===true){
                                return -1;
                            }else if (b.connected===true){
                                return 1;
                            }
                            // Only one has password
                            if(a.pwd && !b.pwd){
                                return -1;
                            }else if(!a.pwd && !b.pwd){
                                return 1;
                            }
                            // Finally by strength
                            if(a.strength > b.strength){
                                return -1;
                            }else if (a.strength < b.strength){
                                return 1;
                            }
                            return 0;
                        });
                    
                    },
                    fetchData: function(url,callback){
                        console.log('fetching data');
                        var httpRequest = new XMLHttpRequest();
                        httpRequest.onreadystatechange = function(){
                            if (httpRequest.readyState === XMLHttpRequest.DONE) {
                                if (httpRequest.status === 200) {
                                    console.log(response);
                                    var response = JSON.parse(httpRequest.responseText);
                                    callback(response);
                                } else {
                                    //TO-DO: add alert UI for end user
                                    console.log('failed to get json feed.');
                                }
                            }
                        }.bind(this);
                        httpRequest.open('GET', url);
                        httpRequest.send();
                    },
                    updateNetworks: function(response){
                        this.networks = response.data;
                        this.sortNetworks();
                    },
                },
                created:function(){
                    this.fetchData('/networks.json',this.updateNetworks);
                }

            })
        </script>
	</body>
</html>